---
title: "C6331 | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-devops-test"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "C6331"
helpviewer_keywords: 
  - "C6331"
ms.assetid: cb1ecc2c-29a5-4c57-acf2-0954a4c047b1
caps.latest.revision: 12
caps.handback.revision: 12
author: "corob-msft"
ms.author: "corob"
manager: "ghogen"
---
# C6331
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

Avertissement C6331 : Paramètre non valide : le passage de MEM\_RELEASE et MEM\_DECOMMIT en association avec \<fonction\> n'est pas autorisé.  Cela provoque l'échec de cet appel.  
  
 Ce message indique qu'un paramètre non valide est passé à VirtualFree ou VirtualFreeEx.  VirtualFree et VirtualFreeEx refusent tous deux les indicateurs \(MEM\_RELEASE &#124; MEM\_DECOMMIT\) en association.  Par conséquent, les valeurs MEM\_DECOMMIT et MEM\_RELEASE ne peuvent pas être utilisées conjointement dans le même appel.  
  
 Il n'est pas nécessaire que l'annulation de la validation et la libération soient considérées comme des étapes indépendantes.  La libération de la mémoire allouée annule également la validation des pages.  Vérifiez également que la valeur de retour de cette fonction n'est pas ignorée.  
  
## Exemple  
 L'exemple de code suivant génère cet avertissement :  
  
```  
#include <windows.h>  
#define PAGELIMIT 80  
  
DWORD dwPages = 0;  // count of pages   
DWORD dwPageSize;   // page size   
  
VOID fd( VOID )  
{  
  LPVOID lpvBase;            // base address of the test memory  
  BOOL bSuccess;             
  SYSTEM_INFO sSysInfo;      // system information  
  
  GetSystemInfo( &sSysInfo );    
  dwPageSize = sSysInfo.dwPageSize;  
  
  // Reserve pages in the process's virtual address space  
  lpvBase = VirtualAlloc (  
                       NULL,                 // system selects address  
                       PAGELIMIT*dwPageSize, // size of allocation  
                       MEM_RESERVE,          
                       PAGE_NOACCESS );       
  if (lpvBase)  
  {  
    // code to access memory   
  }  
  else  
  {  
    return;  
  }  
  bSuccess = VirtualFree(lpvBase,              
                0,  
                MEM_DECOMMIT | MEM_RELEASE); // warning   
  // code...  
}  
```  
  
 Pour corriger cet avertissement, ne passez pas une valeur MEM\_DECOMMIT à un appel VirtualFree, comme indiqué dans le code suivant :  
  
```  
#include <windows.h>  
#define PAGELIMIT 80  
  
DWORD dwPages = 0;  // count of pages   
DWORD dwPageSize;   // page size   
  
VOID f( VOID )  
{  
  LPVOID lpvBase;            // base address of the test memory  
  BOOL bSuccess;             
  SYSTEM_INFO sSysInfo;      // system information  
  
  GetSystemInfo( &sSysInfo );    
  dwPageSize = sSysInfo.dwPageSize;  
  
  // Reserve pages in the process's virtual address space  
  lpvBase = VirtualAlloc (  
                       NULL,                 // system selects address  
                       PAGELIMIT*dwPageSize, // size of allocation  
                       MEM_RESERVE,          
                       PAGE_NOACCESS );       
  if (lpvBase)  
  {  
    // code to access memory   
  }  
  else  
  {  
    return;  
  }  
  bSuccess = VirtualFree(lpvBase, 0, MEM_RELEASE);   
  // code...  
}  
```  
  
 Notez que l'utilisation de malloc et free \(et des API connexes d'allocation mémoire dynamique\) présente de nombreux pièges en termes de fuites de mémoire et d'exceptions.  Pour éviter complètement ce genre de problème de fuites et d'exception, utilisez les mécanismes fournis par la bibliothèque de modèles standard \(STL\) C\+\+.  Ceux\-ci incluent [shared\_ptr](/visual-cpp/standard-library/shared-ptr-class), [unique\_ptr](/visual-cpp/standard-library/unique-ptr-class), et [vector](../Topic/%3Cvector%3E.md).  Pour plus d’informations, consultez [Pointeurs intelligents](/visual-cpp/cpp/smart-pointers-modern-cpp) et [Bibliothèque standard C\+\+](/visual-cpp/standard-library/cpp-standard-library-reference).  
  
## Voir aussi  
 [VirtualAlloc, méthode](../Topic/IHostMemoryManager::VirtualAlloc%20Method.md)   
 [VirtualFree, méthode](../Topic/IHostMemoryManager::VirtualFree%20Method.md)